# Опис

Відео демонстрація:

[![IMAGE ALT TEXT HERE](https://img.youtube.com/vi/MiOdIXQ3F5w/0.jpg)](https://www.youtube.com/watch?v=MiOdIXQ3F5w)

На цьому ресурсі викладено модифіковану прошивку INAV 5.0 з можливістю навігаціі за умов **тимчасової** відсутності GPS.
Працює лише на літаках.
Основна мета модифікації - **повернення літака домому без GPS**.

Літак повинен бути обладнаний датчиками:
- акселерометр/гіроскоп
- барометр
- GPS
- компас

Наявна прошивка INAV відключає всі навігаційні режими при втраті GPS сигналу. При польотах над недоступною місцевістю, втрата сигналу керування означає втрату літака, оскільки літак може лише або продовжувати безконтрольно летіти, або приземлитися.

Модифікована прошивка дозволяє повернути літак, вікористовуючи лише компас і барометр.

Треба наголосити, що прошивка **не є рішенням для виконання місій в умовах повної відсутності GPS**. Якщо повернення додому з похибкою +-2км для відновлення сигналу керування є нормальним, то виконання місій з такою похибкою навряд чи є доцільним.

**Начасі прошивка протестована лише в симуляторі!!!** https://github.com/RomanLut/INAV-X-Plane-HITL

**Потрібна допомога з тестуванням і відгуки, https://t.me/INAV_UA**

# Завантаження

Прошивку можна заватнажити тут https://github.com/RomanLut/inav/tree/5.0.0_gps_fix_estimation/firmware

або самостійно зібрати з branch https://github.com/RomanLut/inav/tree/5.0.0_gps_fix_estimation

# Як це працює ?

За нормальних умов, літак отримує своє положення від датчика GPS, що надає йому можливість здійснювати навігацію згідно маршруту.

За відсутності GPS, літак має інформацію лише про напрямок польоту (компас).

Припустивши, що в навігаційних режимах літак рухається з постійною відомою швидкістю, є можливість вираховувати своє положення, вікористовуючи напрямок і швидкість. 

Але така навігація не є точною. З часом накопичується істотна похибка.



# Налаштування

Включення навігації без GPS виконується командою CLI:

```set inav_allow_gps_fix_estimation=ON```

Також (дуже важливо) якомога точніше вказати швидкісь літака в режимі CRUZ. Для цього потрібно вивести швидкість на OSD і здійснити тестовий політ. Щоб мінімізувати вплив вітру, потрібно здійснити польоти в протилежних напрямках і вирахувати середнє.

Швидкіть потрібно вказати в м/с. 

Щоб перевести з км/г до см/с, потрібно домножити на 27.77.

Наприклад, 100 км/г = 100 * 27.77 = 2777 см/с

```set fw_reference_airspeed=2777```

*Важливо, щоб в умовах втрати GPS літак летів з вказаною швидкістю. Якщо у вас налаштовано збільшення Cruise Throttle за допомогою стіку, не використовуйте це в моменти відсутності GPS.*

Якщо є потреба виконувати місії без сигналу керування, вводимо:

```set failsafe_mission=OFF```

**Після введення команд, важливо зберегти налаштування командою:**

```save```

# Відключення датчика GPS з пульта керування

![](Screenshots/gps_off_box.png) 

Ця можливість може використовуватись:
- для тестування навігації без GPS
- для навмисного відключення GPS в умовах GPS спуфінгу

# Що включає ця модифікація ?

- INAV 5.0 release
- підтримку симулятора https://github.com/RomanLut/INAV-X-Plane-HITL
- можливість навігаціі за умов тимчасової відсутності GPS
- можливість відключати GPS з пульта управління


# Навіщо це потрібно, Ardupilot давно так може?

Так, і рекомендується використовувати пошивку Ardupilot, яка набагато більше розвинена. Але не всі польотні контролери підтримують Ardupilot. Ця прошивка рекомендується для літаків, які наразі використовують INAV. У будь-якому випадку, краще мати якісь шанси врятувати літак, ніж ніяких.

# Чи є подібне рішення для квадкоптерів ?

Начасі нажаль немає.


# Special thanks

Many thanks to Sergii Sevriugin for testing

# Links

INAV HITL, симулятор https://github.com/RomanLut/INAV-X-Plane-HITL
